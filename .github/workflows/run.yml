name: Esecuzione Probabili Serie A (prod)

on:
  schedule:
    # ATTENZIONE: GitHub Actions usa l'UTC per il cron.
    # 05:00â€“23:00 italiane â‰ˆ 04:00â€“22:00 UTC (CET). 
    - cron: "0 4-22 * * 1-3"    # LunedÃ¬-MercoledÃ¬: ogni ora
    - cron: "*/30 4-22 * * 4"   # GiovedÃ¬: ogni 30 minuti
    - cron: "*/10 4-22 * * 5,6" # VenerdÃ¬-Sabato: ogni 10 minuti
    - cron: "*/30 4-22 * * 0"   # Domenica: ogni 30 minuti
  workflow_dispatch:

# Evita esecuzioni sovrapposte
concurrency:
  group: probabili-prod
  cancel-in-progress: false

env:
  TZ: Europe/Rome

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi
          # Playwright (se lo usi per gli screenshot)
          playwright install --with-deps chromium || true

      - name: Decode Google credentials
        env:
          GOOGLE_CREDENTIALS_B64: ${{ secrets.GOOGLE_CREDENTIALS_B64 }}
        run: |
          echo "${GOOGLE_CREDENTIALS_B64}" | base64 --decode > credentials.json
          test -s credentials.json || { echo "credentials.json vuoto"; exit 1; }
          echo "Credenziali decodificate."

      - name: Run production script
        env:
          GOOGLE_APPLICATION_CREDENTIALS: ${{ github.workspace }}/credentials.json
          # ðŸ‘‰ Metti la URL della cartella Drive in Repository Variables come DRIVE_FOLDER_URL
          DRIVE_FOLDER: ${{ vars.DRIVE_FOLDER_URL }}
          # Se il tuo script supporta queste flag, le leggiamo da env:
          RUN_ALL_SOURCES: "1"
          IMAGES_ONLY: "1"
        run: |
          echo "Esecuzione probabili.py"
          python -u probabili.py
